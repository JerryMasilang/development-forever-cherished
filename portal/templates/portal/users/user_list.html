{% extends "portal/base.html" %} {% block title %}User Management{% endblock %}
{% block content %}
<div class="d-flex align-items-center justify-content-between mb-3">
  <div>
    <h3 class="mb-0">User Management</h3>
    <div class="text-muted">Create users and assign portal roles.</div>
  </div>

  <a class="btn btn-success" href="{% url 'portal:users:user_create' %}">
    <i class="bi bi-person-plus me-1"></i> New User
  </a>
</div>

<div class="card shadow-sm">
  <div class="table-responsive">
    <table class="table table-hover align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th>Username</th>
          <th>Email</th>
          <th>Role</th>
          <th>Status</th>
          <th class="text-end">Actions</th>
         </tr>
      </thead>
      {% comment %} <tbody>
        {% for u in users %}
        <tr>
          <td class="fw-semibold">{{ u.username }}</td>
          <td>{{ u.email }}</td> 
          <td>
            {{ u.profile.role|default:"N/A" }}
            {% if u.profile.is_superadmin %}
              <span class="badge bg-dark ms-2">SuperAdmin</span>
            {% endif %}
          </td>

 <a class="btn btn-sm btn-outline-success" href="{% url 'portal:users:user_activate' u.id %}">Activate</a>
          <a class="btn btn-sm btn-outline-secondary" href="{% url 'portal:users:user_deactivate' u.id %}">Deactivate</a>
          <a class="btn btn-sm btn-outline-warning" href="{% url 'portal:users:user_set_pending' u.id %}">Pending</a>
          <a class="btn btn-sm btn-outline-danger" href="{% url 'portal:users:user_suspend' u.id %}">Suspend</a>
        


          <td>
            {% if u.profile.account_status == "active" %}
              <span class="badge bg-success">Active</span>
            {% elif u.profile.account_status == "inactive" %}
              <span class="badge bg-secondary">Inactive</span>
            {% elif u.profile.account_status == "suspended" %}
              <span class="badge bg-danger">Suspended</span>
            {% elif u.profile.account_status == "pending" %}
              <span class="badge bg-warning text-dark">Pending</span>
            {% else %}
              <span class="badge bg-light text-dark">Unknown</span>
            {% endif %}
          </td>         

          <td class="text-end">
            {% if u.profile.is_superadmin %}
              <span class="btn btn-sm btn-outline-secondary disabled">N/A</span>
            {% else %}
              <a
                class="btn btn-sm btn-outline-secondary"
                href="{% url 'portal:users:user_edit' u.id %}"
              >
                <i class="bi bi-pencil"></i> Edit
              </a>

              <a
                class="btn btn-sm btn-outline-danger"
                href="{% url 'portal:users:user_reset_mfa' u.id %}"
              >
                <i class="bi bi-shield-lock"></i> Reset MFA
              </a>
            {% endif %}
          </td>



        </tr>
        {% empty %}
        <tr>
          <td colspan="5" class="text-center text-muted py-4">
            No users found.
          </td>
        </tr>
        {% endfor %}
      </tbody> {% endcomment %}
      <tbody>
  {% for u in users %}
  <tr>
    <td class="fw-semibold">{{ u.username }}</td>
    <td>{{ u.email }}</td>
    <td>{{ u.profile.role|default:"N/A" }}</td>

    <td>
      {% if u.profile.account_status == "active" %}
        <span class="badge bg-success">Active</span>
      {% elif u.profile.account_status == "inactive" %}
        <span class="badge bg-secondary">Inactive</span>
      {% elif u.profile.account_status == "suspended" %}
        <span class="badge bg-danger">Suspended</span>
      {% elif u.profile.account_status == "pending" %}
        <span class="badge bg-warning text-dark">Pending</span>
      {% else %}
        <span class="badge bg-light text-dark">Unknown</span>
      {% endif %}
    </td>

    <td class="text-end">
      {% if u.profile.is_superadmin %}
        <span class="btn btn-sm btn-outline-secondary disabled">N/A</span>
      {% else %}
        <a class="btn btn-sm btn-outline-success" href="{% url 'portal:users:user_activate' u.id %}">Activate</a>
        <a class="btn btn-sm btn-outline-secondary" href="{% url 'portal:users:user_deactivate' u.id %}">Deactivate</a>
        <a class="btn btn-sm btn-outline-warning" href="{% url 'portal:users:user_set_pending' u.id %}">Pending</a>
        <a class="btn btn-sm btn-outline-danger" href="{% url 'portal:users:user_suspend' u.id %}">Suspend</a>

        <a class="btn btn-sm btn-outline-secondary" href="{% url 'portal:users:user_edit' u.id %}">
          <i class="bi bi-pencil"></i> Edit
        </a>
        <a class="btn btn-sm btn-outline-danger" href="{% url 'portal:users:user_reset_mfa' u.id %}">
          <i class="bi bi-shield-lock"></i> Reset MFA
        </a>
      {% endif %}
    </td>
  </tr>
  {% empty %}
  <tr>
    <td colspan="5" class="text-center text-muted py-4">No users found.</td>
  </tr>
  {% endfor %}
</tbody>


    </table>
  </div>
</div>
{% endblock %}
